#!/usr/bin/env bash

SCRIPT_PATH="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_PATH="$(cd "$SCRIPT_PATH/.." && pwd)"

SRC_DIR="$PROJECT_PATH/src"
INCLUDE_DIR="$PROJECT_PATH/include"
BIN_DIR="$PROJECT_PATH/bin"

OUTPUT="$BIN_DIR/room-manage"
CFLAGS=(-std=c2x -Wall -I "$INCLUDE_DIR")

mkdir -p "$BIN_DIR"

SOURCES=()

while IFS= read -r src; do
    SOURCES+=("$src")
done < <(find "$SRC_DIR" -name '*.c')

if ! (gcc "${CFLAGS[@]}" "${SOURCES[@]}" -o "$OUTPUT"); then
    echo 'Failed to build!' >&2
    exit 1
fi

echo 'Build successfully!'
